{"version":3,"file":"bundle.umd.js","sources":["../src/index.js"],"sourcesContent":["//@flow\nimport React, { Component, type Node } from \"react\";\n\nexport type OffsetYContextType = {\n  offsetY?: number,\n  listItemHeight: number,\n  columnsPerRow: number,\n  centerYStart: number,\n  centerYEnd: number,\n  listItemLowerBound: number,\n  listItemUpperBound: number,\n  initialOffset: number,\n  contentOffset: number\n};\n\nconst OffsetYContext = React.createContext<OffsetYContextType>({\n  offsetY: undefined,\n  listItemHeight: 0,\n  columnsPerRow: 1,\n  centerYStart: 0,\n  centerYEnd: 0,\n  listItemLowerBound: 0,\n  listItemUpperBound: 0,\n  initialOffset: 0,\n  contentOffset: 0\n});\n\nexport type IndexContextType = number;\n\nconst IndexContext = React.createContext<IndexContextType>(0);\n\ntype SetOffsetYFunction = (offsetY: number) => void;\n\nexport type OffsetYProviderFaCCOptions = {\n  setOffsetY: (offsetY: number) => void\n};\n\nexport type InvokeResultType = {\n  invoke: (offsetY: number) => void,\n  cancel: () => void\n};\n\nexport type InvokeFunctionType = (\n  invoke: SetOffsetYFunction\n) => InvokeResultType;\n\nexport type OffsetYProviderProps = {\n  children: (opts: OffsetYProviderFaCCOptions) => Node,\n  listItemHeight: number,\n  columnsPerRow: number,\n  centerYStart: number,\n  centerYEnd: number,\n  createInvokeFunction?: InvokeFunctionType,\n  listItemLowerBound?: number,\n  listItemUpperBound?: number,\n  initialOffset?: number,\n  contentOffset?: number\n};\n\ntype OffsetYProviderState = {\n  offsetY?: number,\n  setOffsetY: SetOffsetYFunction\n};\n\nexport class OffsetYProvider extends Component<\n  OffsetYProviderProps,\n  OffsetYProviderState\n> {\n  _setOffsetY: SetOffsetYFunction;\n  _invoke: InvokeResultType;\n  constructor(props: any) {\n    super(props);\n    this._setOffsetY = (offsetY: number) => this.setState({ offsetY });\n\n    this._invoke = {\n      invoke: this._setOffsetY,\n      cancel: () => undefined\n    };\n    let setOffsetY = this._setOffsetY;\n\n    if (this.props.createInvokeFunction) {\n      this._invoke = this.props.createInvokeFunction(setOffsetY);\n    }\n\n    this.state = {\n      offsetY: undefined,\n      setOffsetY: (offsetY: number) => this._invoke.invoke(offsetY)\n    };\n  }\n\n  componentDidUpdate(prevProps: OffsetYProviderProps) {\n    if (\n      this.props.createInvokeFunction !== prevProps.createInvokeFunction &&\n      this.props.createInvokeFunction\n    ) {\n      this._invoke = this.props.createInvokeFunction(this._setOffsetY);\n    }\n  }\n\n  componentWillUnmount() {\n    this._invoke.cancel();\n  }\n\n  render() {\n    const {\n      state: { offsetY, setOffsetY },\n      props: {\n        children,\n        listItemHeight,\n        columnsPerRow,\n        centerYStart,\n        centerYEnd,\n        initialOffset = 0,\n        listItemLowerBound = listItemHeight / 2,\n        listItemUpperBound = listItemHeight / 2,\n        contentOffset = 0\n      }\n    } = this;\n    return (\n      <OffsetYContext.Provider\n        value={{\n          offsetY,\n          listItemHeight,\n          columnsPerRow,\n          centerYStart,\n          centerYEnd,\n          listItemLowerBound,\n          listItemUpperBound,\n          initialOffset,\n          contentOffset\n        }}\n      >\n        {children({ setOffsetY })}\n      </OffsetYContext.Provider>\n    );\n  }\n}\n\nexport type IndexProviderProps = {\n  index: number,\n  children: () => Node\n};\n\nexport class IndexProvider extends Component<IndexProviderProps> {\n  render() {\n    const {\n      props: { children, index }\n    } = this;\n    return (\n      <IndexContext.Provider value={index}>{children()}</IndexContext.Provider>\n    );\n  }\n}\n\nexport type ConsumerProps = {\n  children: (opts: { isInCenter: boolean }) => Node\n};\n\nexport class InCenterConsumer extends Component<ConsumerProps> {\n  render() {\n    const {\n      props: { children }\n    } = this;\n\n    return (\n      <OffsetYContext.Consumer>\n        {value => (\n          <IndexContext.Consumer>\n            {index => {\n              let {\n                initialOffset,\n                offsetY = initialOffset,\n                listItemHeight,\n                columnsPerRow = 1,\n                centerYStart,\n                centerYEnd,\n                listItemLowerBound,\n                listItemUpperBound,\n                contentOffset\n              } = value;\n              let isInCenter = false;\n\n              const muliplier = Math.floor(index / columnsPerRow);\n              const offsetTop = listItemHeight * muliplier + contentOffset;\n              const positionRelativeToViewport = offsetTop - offsetY;\n\n              const itemLowerY =\n                positionRelativeToViewport + listItemLowerBound;\n\n              const itemUpperY =\n                positionRelativeToViewport + listItemUpperBound;\n\n              if (\n                (itemLowerY >= centerYStart || itemUpperY >= centerYStart) &&\n                (itemLowerY <= centerYEnd || itemUpperY <= centerYEnd)\n              ) {\n                isInCenter = true;\n              }\n              return children({ isInCenter });\n            }}\n          </IndexContext.Consumer>\n        )}\n      </OffsetYContext.Consumer>\n    );\n  }\n}\n"],"names":["OffsetYContext","React","createContext","offsetY","undefined","listItemHeight","columnsPerRow","centerYStart","centerYEnd","listItemLowerBound","listItemUpperBound","initialOffset","contentOffset","IndexContext","OffsetYProvider","props","_setOffsetY","setState","_invoke","invoke","cancel","setOffsetY","createInvokeFunction","state","componentDidUpdate","prevProps","componentWillUnmount","render","children","Component","IndexProvider","index","InCenterConsumer","value","isInCenter","muliplier","Math","floor","offsetTop","positionRelativeToViewport","itemLowerY","itemUpperY"],"mappings":"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"}